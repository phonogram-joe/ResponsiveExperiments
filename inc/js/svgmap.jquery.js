(function($, Raphael) {
    var MAP_ATTRS = {
        nodeId: '#svgmap',
        width: 595,
        height: 842,
        areas: [
            {
                id: 'somewhere',
                fill: '#8ABF22',
                path: 'M377.104,257.774c-0.157-0.211-0.771-0.481-0.925-0.732c-0.652-1.056-0.857-2.072-1.379-2.594c-0.307-0.537-0.805-0.609-0.914-1.183c-0.075-0.401-0.542-1.702-0.245-2.641c0.188-0.597,0.914-1.012,0.965-1.275c0.115-0.594-0.06-1.287-0.04-1.896c0.01-0.229,0.943-1.247,0.809-1.743c-0.104-0.39-1.405-1.579-1.477-2.006c-0.101-0.619,0.572-1.026,0.817-1.463c0.147-0.261-0.079-1.54,0.212-1.902c0.57-0.713,1.779-1.492,1.855-2.063c0.073-0.562,0.01-2.203-0.135-3.249c-0.105-0.153-1.632-1.061-1.756-1.26c-0.511-0.819-1.398-2.495-1.993-3.28c-0.498-0.654-1.895-1.131-2.577-1.83c-0.332-0.338-0.182-1.162-0.186-1.387c-0.141-0.069-1.887-3.081-2.329-3.188c-0.728-0.174-1.62-0.314-1.882-0.136c-0.315,0.212-0.592,1.571-0.967,1.571c-0.482,0-1.728-0.908-2.145-0.922c-0.922,0.029-3.232,0.936-4.986,1.03c-0.801,0.043-1.108-0.728-1.5-0.813c-1.162-0.252-2.039,1.3-2.469,1.138c-0.375-0.109-0.861-1.242-0.861-1.242s-0.748-0.142-1.229-0.464c-0.054-0.037-0.126-1.074-0.788-1.125c-0.584-0.044-1.238,0.163-2.072,0.209c-0.246,0.013-0.859-0.302-1.113-0.283c-0.471,0.035-0.979,0.726-1.441,0.699c-0.705-0.042-2.91-0.003-2.91-0.003c-0.507,0.234-0.65,1.061-1.126,1.478c-0.358,0.316-1.831,0.303-2.252,0.243c-0.28-0.04-0.323-0.468-1.005-1.178c-0.346-0.361-0.972-0.16-1.327-0.487c-0.151-0.139-0.286-1.119-0.442-1.26c-0.726-0.651-2.113-1.999-3.103-2.092c-1.245,0.166-1.264,1.968-1.562,2.418c-0.442,0.666-3.004,1.45-3.78,1.381c-0.709-0.064-1.21-1.139-1.974-0.986c-0.637,0.127-2.275,0.141-2.936-0.354c-0.584-0.438-0.724-1.746-1.097-2.298c-0.124-0.184-0.681-0.832-1.017-0.845c-1.265,0.182-2.082,0.297-2.813,0.65c-0.655,0.316-1.015,0.983-1.593,1.382c-0.448,0.65-1.758,2.09-2.189,2.649c-0.436,0.565-1.861,1.597-1.941,2.298c0.104,0.424,1.385,1.634,1.194,1.949c-0.172,0.287-0.965,0.417-1.294,0.599c-0.327,0.182-1.365,0.806-1.592,1.068c-0.368,0.426-0.444,1.238-0.896,1.864c-0.523,0.728-2.074,1.055-2.438,1.565c-0.439,0.615,0.05,1.399-0.249,1.799c-0.468,0.625-2.103,0.399-2.638,0.98c-0.076,0.083-0.037,0.383,0.02,0.739l0.891,0.04c0.191-0.234,1.431-0.571,2.211-0.447c0.483,0.076,0.436,0.753,0.765,0.771c0.542,0.029,1.885,0.29,2.252,0.122c0.442-0.203,1.278-1.63,1.953-1.937c0.204-0.092,1.876-0.342,1.868-0.053c-0.008,0.278-0.26,2.314-0.402,2.965c-0.111,0.509-0.9,0.696-1.005,1.097c-0.195,0.74,0.628,2.547,0.655,3.127c0.016,0.306-0.523,0.736-0.348,1.003c0.227,0.34,0.84,1.038,1.221,1.272c0.381,0.235,0.494-0.441,0.845-0.284c0.167,0.075,0.225,0.5,0.276,1.016c0.08,0.827-0.801,1.38-0.72,1.949c0.03,0.215,0.341,0.503,0.804,0.653c0.362,0.119,0.604-0.125,1.086-0.125c0.313,0,1.427,1.082,1.569,1.3c0.407,0.625,0.377,2.727,0.563,3.412c0.104,0.381,1.89,0,1.929,0.447c0.026,0.282,0.101,1.414-0.24,1.99c-0.224,0.376-0.888,0.24-0.952,0.43c-0.131,0.382-0.058,1.982,0.027,2.373c-0.037,0.867,1.012,1.802,1.486,2.152c0.711,0.521,1.791,1.042,2.264,1.531c0.571,0.592,1.464,1.277,2.178,1.839c0.225,0.179,0.495,1.227,0.717,1.411c0.578,0.476,1.426,0.339,1.863,0.888c0.202,0.252,0.25,1.431,0.27,1.734c0.638-0.136,1.34-0.64,1.591-1.006c0.522-0.757,1.405-2.88,1.854-3.187c0.168-0.116,0.381,1.703,0.43,1.798c0.129,0.254,1.494,0.622,2.129,1.099c0.994,0.748,2.652,3.271,4.017,3.474c-0.006,0.416-0.022,1.405-0.463,1.969c-0.272,0.349-0.985,0.255-1.126,0.597c-0.17,0.411,0.061,0.849,0.268,1.138c0,0,1.619-0.05,1.823,0.217c0.203,0.265,0.234,1.25,0.483,1.246c0.247-0.004,2.298-0.539,2.572-0.541c0.076-0.246,0.526-1,0.482-1.355c-0.066-0.549-0.432-1.506-0.105-1.625c0.317-0.116,1.117,1.029,1.554,1.084c0.188,0.023,1.297-0.725,1.501-0.76c0.689-0.111,0.912,0.76,1.234,0.76c0.701,0,1.998,0.505,2.09,0.975c0.129,0.639-0.248,3.364-0.428,3.846c0.422,0.186,1.188,0.221,1.662-0.055c0.33-0.193,1.178-2.156,1.394-2.221c0.347-0.102,0.747-0.424,1.046-0.541c0.881-0.342,2.884-0.277,3.727-0.107c0,0,0.246-1.354,0.215-1.734c-0.054-0.65-3.183-2.817-3.86-3.574c-0.731-0.818,0.858-2.816,0.858-3.521c0-0.259-0.814-1.514-0.944-1.742c-0.162-0.284,0.311-0.722,0.534-1.133c0.261-0.474,0.271-1.198,0.517-1.512c0.821-0.129,1.638-2.003,2.253-2.24c0.383-0.147,1.057,0.565,1.49,0.708c0.212,0.071,0.748-0.084,0.894-0.165c0.294-0.162,2.196-0.387,2.524-0.578c0.378-0.219,1.253-1.442,1.663-1.083c0.446,0.392,1.243,1.855,1.394,2.546c0.073,0.332,1.045,1.053,1.096,1.408c0.098,0.682-0.136,1.072-0.213,1.733c-0.015,0.11,0.551,0.357,0.75,0.433c0.252,0.099,0.834,1.197,1.192,1.084c-0.069-0.389-0.14-0.97,0.04-1.138c0.193-0.18,0.945-0.485,1.207-0.609c0.572-0.272,1.564-1.103,2.01-1.341c0.168-0.089,0.332-1.193,0.299-1.706c-0.029-0.426-0.465-0.815-0.24-1.015c0.336-0.303,1.199-0.33,1.93-0.162c0.834,0.19,1.785,0.925,2.372,0.934c0.915,0.013,2.286-0.836,3.057-0.853C378.008,259.175,377.379,258.142,377.104,257.774'
            },
            {
                id: 'somewhere',
                fill: '#0080FF',
                path: 'M383.985,265.518c-0.111-0.383-1.865-1.356-2.226-1.649c-0.214-0.174-0.554-1.118-0.78-1.275c-0.293-0.202-0.588,0.234-0.88,0.027c-0.408-0.289-1.696-1.053-1.754-1.565c-0.033-0.289-0.002-1.111-0.24-1.562c-0.771,0.017-2.141,0.865-3.056,0.852c-0.588-0.008-1.539-0.743-2.374-0.934c-0.729-0.167-1.593-0.14-1.929,0.163c-0.225,0.2,0.213,0.588,0.24,1.015c0.034,0.513-0.131,1.617-0.299,1.706c-0.445,0.237-1.438,1.069-2.01,1.341c-0.262,0.123-1.014,0.429-1.207,0.609c-0.18,0.168-0.109,0.748-0.04,1.137c-0.356,0.114-0.94-0.984-1.192-1.083c-0.197-0.077-0.765-0.323-0.752-0.433c0.079-0.661,0.313-1.052,0.215-1.734c-0.051-0.354-1.022-1.076-1.096-1.408c-0.15-0.69-0.947-2.154-1.394-2.545c-0.41-0.359-1.285,0.864-1.663,1.083c-0.328,0.191-2.23,0.415-2.523,0.578c-0.146,0.08-0.683,0.235-0.895,0.165c-0.434-0.144-1.107-0.856-1.49-0.709c-0.613,0.237-1.432,2.112-2.253,2.24c-0.244,0.314-0.256,1.039-0.517,1.513c-0.224,0.409-0.696,0.849-0.534,1.132c0.13,0.229,0.944,1.482,0.944,1.743c0,0.704-1.59,2.703-0.858,3.521c0.678,0.758,3.807,2.924,3.86,3.574c0.031,0.381-0.215,1.732-0.215,1.732c-0.08,0.293-0.002,1.433-0.16,2.492c-0.142,0.947-0.709,1.24-0.59,1.57c0.172,0.48,0.61,1.623,1.18,2.112c0.125,0.108,0.636,0.004,0.725,0.058c0.447,0.422,1.419,1.074,2.01,1.242c0.508,0.145,1.311,1.544,1.311,2.199c0,0.65-1.127,1.029-1.609,1.57c-0.102,0.113-0.609,1.055-0.428,1.3c0.146,0.198,1.141,0.245,1.179,0.434c0.085,0.421-0.678,0.722-0.696,1.082c0.678,0.048,2.446,1.907,2.926,2.167c0.459,0.25,1.533-0.091,2.305,0.163c0.542,0.177,0.843,0.896,1.072,1.245c0.563-0.798,2.285-1.281,2.843-1.896c0.47-0.518,0.856-2.111,1.394-2.22c0.314-0.063,1.121,1.005,1.502,0.812c0.213-0.107,0.479-1.34,0.858-1.082c0.224,0.152,0.101,2.533,0.106,3.466c0.002,0.196,0.791,0.177,0.791,0.177c0.148,0.088,0.533-0.202,0.845-0.041c0.681,0.352,1.086,1.301,1.729,1.178c0.431-0.082,0.147-1.75,0.482-2.355s2.024-1.732,2.493-2.275c0.139-0.158-0.198-1.205-0.079-1.422c0.184-0.336,0.827,0.163,1.147,0c0.443-0.222,0.641-1.281,1.088-1.502c0.563-0.281,1.323-0.23,1.527-0.488c0.322-0.406-0.936-2.42-1.109-3.146c0.213-0.002,1.213-0.001,1.512-0.004c-0.094-0.535-0.176-1.039-0.252-1.409c-0.104-0.509-0.834-0.888-1.147-1.392c-0.366-0.588,1.31-2.527,1.296-2.881c-0.014-0.314-0.98-0.977-1.006-1.179c-0.119-0.175,0.4-0.83,0.443-1.178c0.082-0.673-0.047-1.095,0.32-1.869c0.187-0.392,0.789-0.868,0.885-1.138c0.113-0.311-0.741-0.449-0.705-0.937c0.035-0.452,0.57-1.231,0.865-1.825C384.388,267.245,384.112,265.95,383.985,265.518'
            },
            {
                fill: '#00B1F7',
                path: 'M396.773,343.357c-0.056-0.168-0.237-0.26-0.348-0.385c-0.111-0.126-1.188-0.06-1.276,0.012s0.037,1.006,0.148,1.119c0.109,0.112,0.559-0.423,0.662-0.428c0.105-0.008,0.629,0.24,0.629,0.24S396.803,343.447,396.773,343.357M393.337,313.661c-0.114-0.271,0.33-1.697,0.328-1.967c0-0.236-0.215-0.441-0.166-0.787c0.072-0.524,0.886-1.47,0.945-1.877c0.039-0.271-0.102-0.523-0.283-0.77c-0.268-0.362-0.623-0.706-0.627-1.064c-0.063-0.412-0.121-1.416-0.444-1.912c-0.278-0.428-2.114-1.291-2.263-1.652c-0.246-0.494-0.642-2.582-0.928-2.775c-0.335-0.225-1.893-0.488-2.451-0.975c-0.43-0.376-0.67-1.573-0.964-2.174c-0.342-0.697-1.393-1.661-1.393-2.223c0-0.443,0.925-1.098,0.983-1.828c0.041-0.422-0.566-0.662-0.519-1.086c0.112-1.021,1.403-2.123,1.762-2.931c0.278-0.624,0.388-1.753,0.187-2.362c0,0-1.727-0.009-2.116-0.562c-0.164-0.233,0.063-0.815-0.037-1.388c-0.078-0.437-1.142-1.232-1.226-1.424c-0.256-0.586-0.641-1.438-0.805-2.377c-0.298,0.004-1.299,0.002-1.511,0.004c0.174,0.728,1.431,2.74,1.108,3.147c-0.203,0.257-0.963,0.206-1.527,0.487c-0.445,0.222-0.643,1.279-1.086,1.502c-0.321,0.164-0.965-0.336-1.148,0c-0.119,0.217,0.217,1.264,0.08,1.423c-0.471,0.542-2.16,1.669-2.494,2.274s-0.052,2.274-0.482,2.356c-0.643,0.121-1.049-0.826-1.729-1.179c-0.312-0.161-0.697,0.13-0.845,0.041c0,0-0.79,0.02-0.792-0.176c-0.006-0.934,0.117-3.314-0.105-3.467c-0.381-0.258-0.645,0.975-0.859,1.084c-0.38,0.191-1.188-0.877-1.501-0.813c-0.537,0.107-0.924,1.701-1.394,2.221c-0.558,0.614-2.28,1.096-2.844,1.895c-0.084,0.18-0.724,0.688-1.018,1.246c-0.326,0.617,0.855,1.479,0.912,1.679c0.08,0.284-0.627,1.118-0.43,1.409c0.479,0.701,0.569,1.701,0.858,2.381c0.341,0.809,2.513,2.865,3.163,3.521c0.249,0.252-0.128,1.122-0.055,1.733c0.055,0.442,0.594,0.567,0.592,1.083c-0.003,0.559-0.417,1.326-0.805,1.679c-0.313,0.202-1.242,0.278-1.556,0.487c-0.229,0.154-1.483,2.32-1.692,2.492c-0.695,0.567-1.77,0.217-1.77,0.217c-0.363,0.458-1.104,1.674-1.607,1.895c0.146,0.266,0.549,1.463,0.767,1.42c0.497-0.097,1.979-1.344,2.504-0.933c0.347,0.272,0.394,1.028,0.321,1.409c-0.006,0.031-0.213,0.381-0.449,0.779c-0.32,0.541-0.557,2.804-1.053,3.607c-0.229,0.37-1.93,0.064-1.984,0.541c0.034,0.633,1.107,1.836,2.253,2.438c0.193,0.102,0.798-0.483,0.963-0.375c0.446,0.291,0.755,0.607,0.752,0.971c-0.002,0.425-1.608,0.217-1.715,0.867c-0.108,0.132,0.479,0.521,0.925,1.084c0.65,0.818,1.271,1.865,1.271,1.865c-0.038-0.496-0.105-1.014-0.105-1.014l0.523,0.203c0,0,0.279,1.615,0.563,1.666c0.241,0.043,0.121-2.803,0.121-2.803c0.221,0.179,1.82,1.129,2.172,1.584c0.281,0.365,0.086,1.371,0.08,1.544c-0.003,0.065,0.316,1.239,0.321,1.34c0.433,0.218,1.364-0.163,1.972,0.081c0.336,0.136,0.747,1.523,0.952,1.675c-0.303,0.56-1.282,2.131-1.436,2.468c0.52,0.297,2.36-0.049,2.694,0.041c0.668,0.182,1.613,0.949,2.092,1.219c0.646,0.365,2.941-0.491,3.297,0.285c0.111,0.239-0.202,1.366-0.08,1.543c0.123,0.176,0.757-0.256,1.126-0.324c0.271,0.045,0.987-0.129,1.286-0.203c0.92-0.229,1.753-1.84,2.494-2.356c0.041-0.546-0.385-0.809-0.455-1.394c-0.036-0.303,0.418-4.081,0.576-4.252c0.287-0.314,2.959-1.404,2.959-1.404l-0.041-1.421l2.856,1.909l1.165-1.504c-0.473-0.351-4.221-3.664-4.264-3.979c-0.098-0.769,0.578-1.26,0.604-1.585c0.026-0.316-0.081-1.271-0.081-1.271l0.725-0.354c0,0-0.196,2.86,0.162,3.331c0.355,0.472,2.918,2.365,3.27,2.302l0.563-1.029c-0.063-0.475-0.026-2.816-0.026-3.33c0-0.129-0.421-0.728-0.482-1.381c-0.024-0.256,0.294-0.568,0.294-0.568s1.073-1.523,1.152-1.924c0.072-0.365,0.32-1.053,0.136-1.258C394.34,313.454,393.337,313.661,393.337,313.661z M387.206,331.959c-0.58-0.109-1.366,0.504-1.187,0.812c0.24,0.413,1.58,0.925,1.829,0.833C388.292,333.442,387.517,332.018,387.206,331.959zM393.513,339.188c-0.082-0.048-0.596-1.334-0.947-1.408c-0.35-0.074-1.277,0.75-1.365,0.82s0.194,0.735,0.203,0.894c0.008,0.158,1.758,0.539,1.864,0.56c0.05,0.01,0.552-0.284,0.664-0.298c0.147-0.02,0.646,0.093,0.627-0.037C394.54,339.587,393.593,339.237,393.513,339.188z'
            }
        ]
    }

    function loadSvgMaps() {
        var R,
            pathAttrs,
            areaIndex,
            areaCount,
            currentArea,
            currentPath,
            $rootNode;
        $rootNode = $(MAP_ATTRS.nodeId);
        $rootNode.width(MAP_ATTRS.width);
        $rootNode.height(MAP_ATTRS.height);

        R = Raphael($rootNode.get(0), MAP_ATTRS.width, MAP_ATTRS.height);
        pathAttrs = {
            fill: '#333',
            stroke: '#666',
            'stroke-width': 1,
            'stroke-linejoin': 'round'
        };
        currentArea = null;
        currentPath = null;
        areaCount = MAP_ATTRS.areas.length;
        for (areaIndex = 0; areaIndex < areaCount; areaIndex++) {
            currentArea = MAP_ATTRS.areas[areaIndex];
            currentPath = R.path(currentArea.path);
            currentPath.color = pathAttrs.fill = Raphael.color(currentArea.fill);
            currentPath.attr(pathAttrs);
        }
    }

    function loadFromSVG($rootNode, $svg) {
        var R,
            width,
            height,
            pathAttrs,
            areaIndex,
            areaCount,
            $areas,
            $area;
        width = $svg.attr('width');
        $rootNode.width(width);
        height = $svg.attr('height');
        $rootNode.height(height);

        R = Raphael($rootNode.get(0), width, height);
        pathAttrs = {
            //fill: '#333', //set from SVG
            stroke: '#666',
            'stroke-opacity': 0,
            'stroke-width': 1,
            'stroke-linejoin': 'round'
        };
        $areas = $svg.find('path');
        $areas.each(function() {
            var currentPath;
            $area = $(this);
            currentPath = R.path($area.attr('d'));
            currentPath.color = pathAttrs.fill = Raphael.color($area.attr('fill'));
            currentPath.attr(pathAttrs);
            currentPath.mouseover(function() {
                currentPath.animate({fill: Raphael.color('#FFF')}, 500);
            });
            currentPath.mouseout(function() {
                currentPath.animate({fill: currentPath.color}, 500);
            });
        });
    }

    $(document).ready(function() {
        $.ajax('map.svg', {
            dataType: 'xml',
            success: function(data) {
                loadFromSVG($('#svgmap'), $(data).find('svg'));
            }
        });
    });
})(jQuery, Raphael);